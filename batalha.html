<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Mini RPG Batalha</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin:2em auto; background:#f4f4f4; }
        .status { background:white; padding:1em; border-radius:8px; margin-bottom:1em; }
        .mensagens { background:#222; color:#eee; padding:1em; height:200px; overflow-y:auto; border-radius:8px; margin-bottom:1em; }
        button { padding:0.7em 1.2em; margin-right:10px; border:none; border-radius:5px; cursor:pointer; }
        button:hover { background:#ddd; }
    </style>
</head>
<body>
<h1>Mini RPG - Batalha</h1>

<div class="status" id="status">
    <!-- Status será atualizado via JS -->
</div>

<div class="mensagens" id="mensagens">
    <!-- Mensagens aparecerão aqui -->
</div>

<div>
    <button onclick="acao('ataque')">Ataque Normal</button>
    <button onclick="acao('especial')">Ataque Especial</button>
    <button onclick="acao('pocao')">Usar Poção</button>
    <button onclick="reiniciar()" style="background:#f66;color:white">Reiniciar Batalha</button>
</div>

<script>
const API_BASE = 'http://127.0.0.1:8000';

async function carregarBatalha() {
    const res = await fetch(`${API_BASE}/batalha`);
    const data = await res.json();
    atualizarStatus(data);
}

async function acao(tipo) {
    try {
        const res = await fetch(`${API_BASE}/acao/${tipo}`, { method: 'POST' });
        if (!res.ok) {
            const err = await res.json();
            alert(err.detail);
            return;
        }
        const data = await res.json();
        atualizarStatus(data);
    } catch (e) {
        console.error("Erro na ação:", e);
    }
}

async function reiniciar() {
    try {
        const res = await fetch(`${API_BASE}/reiniciar`, { method: 'POST' });
        if (!res.ok) {
            const err = await res.json();
            alert(err.detail || 'Erro ao reiniciar');
            return;
        }
        const data = await res.json();
        atualizarStatus(data);
    } catch (e) {
        console.error('Erro ao reiniciar:', e);
    }
}

function atualizarStatus(data) {
    const statusDiv = document.getElementById('status');
    const mensagensDiv = document.getElementById('mensagens');

    const jogador = data.jogador;
    const inimigo = data.inimigo;

    statusDiv.innerHTML = `
        <strong>Você:</strong> ${jogador.nome} | HP: ${jogador.vida}/${jogador.vida_max} | Poções: ${jogador.pocoes}<br>
        <strong>Inimigo:</strong> ${inimigo.nome} | HP: ${inimigo.vida}/${inimigo.vida_max} | Poções: ${inimigo.pocoes}
    `;

    mensagensDiv.innerHTML = '';
    data.mensagens.forEach(msg => {
        const p = document.createElement('p');
        p.textContent = msg;
        mensagensDiv.appendChild(p);
    });

    mensagensDiv.scrollTop = mensagensDiv.scrollHeight;
}

// Carrega o estado inicial ao abrir a página
carregarBatalha();
</script>
</body>
</html>
